openapi: 3.0.0
info:
  title: User Service API
  description: API for user registration, login, profile management, password reset, email verification, OAuth updates, portfolio synchronization, and notifications
  version: 1.0.0

servers:
  - url: http://localhost:3001
    description: Local User Server

tags:
  - name: "ðŸ”µ USER SERVICE - Authentication"
    description: "User Service: Registration, login, and authentication endpoints"
  - name: "ðŸ”µ USER SERVICE - Profile"
    description: "User Service: Profile management and updates"
  - name: "ðŸ”µ USER SERVICE - Security"
    description: "User Service: Password management and email verification"
  - name: "ðŸ”µ USER SERVICE - OAuth"
    description: "User Service: OAuth integration and updates"
  - name: "ðŸ”µ USER SERVICE - Developers"
    description: "User Service: Developer listings and discovery"
  - name: "ðŸ”µ USER SERVICE - Role Management"
    description: "User Service: User role management (Admin only)"
  - name: "ðŸ”µ USER SERVICE - Portfolio Sync"
    description: "User Service: Portfolio synchronization with external platforms (GitHub, StackOverflow)"
  - name: "ðŸ”µ USER SERVICE - Notifications"
    description: "User Service: User notifications management"

paths:
  /api/v1/user/register:
    post:
      summary: Register a new user
      tags:
        - "ðŸ”µ USER SERVICE - Authentication"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Rajan Kumar
                email:
                  type: string
                  format: email
                  example: raorajan9576@gmail.com
                role:
                  type: string
                  enum: [developer, project-owner, admin]
                  default: developer # ðŸ‘ˆ default role
                  example: developer
                domains:
                  type: string
                  example: "web, ai-ml"
                experience:
                  type: string
                  example: "3 years"
                availability:
                  type: string
                  enum: [full-time, part-time, freelance]
                  default: full-time
                  example: full-time
                password:
                  type: string
                  format: password
                  example: 123123
      responses:
        "201":
          description: User registered successfully
        "400":
          description: Bad request

  /api/v1/user/login:
    post:
      summary: Login a user
      description: Authenticates user and returns JWT token stored in HTTP-only cookie for security
      tags:
        - "ðŸ”µ USER SERVICE - Authentication"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [email, password, role]
              properties:
                email:
                  type: string
                  format: email
                  example: raorajan9576@gmail.com
                role:
                  type: string
                  enum: [developer, project-owner, admin]
                  default: developer # ðŸ‘ˆ default role
                  example: developer
                password:
                  type: string
                  example: 123123
      responses:
        "200":
          description: Login successful - JWT token stored in HTTP-only cookie
          headers:
            Set-Cookie:
              description: JWT token stored in HTTP-only cookie
              schema:
                type: string
                example: "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; HttpOnly; Secure; SameSite=Strict"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Login successful"
                  user:
                    $ref: "#/components/schemas/User"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  status:
                    type: integer
                    example: 401
                  message:
                    type: string
                    example: "Invalid email or password"

  /api/v1/user/profile:
    get:
      summary: Get user profile
      tags:
        - "ðŸ”µ USER SERVICE - Profile"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
        "404":
          description: User not found
        "500":
          description: Internal server error

    put:
      summary: Update user profile
      description: Update editable profile fields (does not allow email, password, ID, or system fields)
      tags:
        - "ðŸ”µ USER SERVICE - Profile"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserUpdate"
      responses:
        "200":
          description: Profile updated successfully
        "400":
          description: Invalid request data
        "401":
          description: Unauthorized
        "404":
          description: User not found
        "500":
          description: Internal server error

    delete:
      summary: Delete user profile
      tags:
        - "ðŸ”µ USER SERVICE - Profile"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User deleted successfully
        "401":
          description: Unauthorized
        "404":
          description: User not found
        "500":
          description: Internal server error

  /api/v1/user/verify-email:
    get:
      summary: Verify email using token
      tags:
        - "ðŸ”µ USER SERVICE - Security"
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Email verified
        "400":
          description: Invalid or expired token

  /api/v1/user/verify-email/{id}:
    get:
      summary: Verify email using user ID (fallback)
      tags:
        - "ðŸ”µ USER SERVICE - Security"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Email verified
        "404":
          description: User not found

  /api/v1/user/forgot-password:
    post:
      summary: Send password reset email
      tags:
        - "ðŸ”µ USER SERVICE - Security"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [email]
              properties:
                email:
                  type: string
      responses:
        "200":
          description: Reset email sent
        "404":
          description: User not found

  /api/v1/user/reset-password/{token}:
    put:
      summary: Reset password using token
      tags:
        - "ðŸ”µ USER SERVICE - Security"
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [newPassword]
              properties:
                newPassword:
                  type: string
      responses:
        "200":
          description: Password reset successful
        "400":
          description: Invalid or expired token

  /api/v1/user/change-password:
    put:
      summary: Change password (logged-in user)
      tags:
        - "ðŸ”µ USER SERVICE - Security"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [currentPassword, newPassword]
              properties:
                currentPassword:
                  type: string
                newPassword:
                  type: string
      responses:
        "200":
          description: Password changed
        "401":
          description: Invalid current password

  /api/v1/user/oauth:
    put:
      summary: Update OAuth details
      tags:
        - "ðŸ”µ USER SERVICE - OAuth"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required: [oauthProvider, oauthId]
              properties:
                oauthProvider:
                  type: string
                oauthId:
                  type: string
      responses:
        "200":
          description: OAuth details updated

  /api/v1/user/logout:
    post:
      summary: Logout the currently logged-in user
      description: Invalidates the user's session and clears the JWT token from HTTP-only cookie. No client-side token removal needed.
      tags:
        - "ðŸ”µ USER SERVICE - Authentication"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logout successful - JWT token cleared from HTTP-only cookie
          headers:
            Set-Cookie:
              description: JWT token cleared from HTTP-only cookie
              schema:
                type: string
                example: "token=; HttpOnly; Secure; SameSite=Strict; Max-Age=0"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Logged out successfully"
        "401":
          description: Unauthorized â€“ missing or invalid token
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  status:
                    type: integer
                    example: 401
                  message:
                    type: string
                    example: "Unauthorized"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  status:
                    type: integer
                    example: 500
                  message:
                    type: string
                    example: "Logout failed"
                  error:
                    type: string
                    example: "Error message"

  /api/v1/user/developers:
    get:
      summary: Get all developers
      description: Retrieve a list of all developers in the system
      tags:
        - "ðŸ”µ USER SERVICE - Developers"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of developers returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/chat/users:
    get:
      summary: Get chat users (developers and project owners)
      description: Retrieve a list of all developers and project owners for chat purposes. The authenticated user is automatically excluded from the results.
      tags:
        - "ðŸ”µ USER SERVICE - Developers"
      security:
        - bearerAuth: []
      parameters:
        - name: search
          in: query
          description: Search users by name, email, or bio
          schema:
            type: string
          example: "john"
        - name: limit
          in: query
          description: Maximum number of users to return
          schema:
            type: integer
            default: 200
            minimum: 1
            maximum: 500
          example: 200
      responses:
        "200":
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Users retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
                    description: Array of users (developers and project owners) with signed avatar URLs
                  count:
                    type: integer
                    description: Total number of users returned
                    example: 25
              example:
                success: true
                status: 200
                message: "Users retrieved successfully"
                data:
                  - id: 1
                    name: "John Doe"
                    email: "john@example.com"
                    role: "developer"
                    avatarUrl: "https://supabase.co/storage/v1/object/sign/upload/avatar.jpg?token=..."
                    bio: "Full-stack developer"
                    location: "New York, USA"
                  - id: 2
                    name: "Jane Smith"
                    email: "jane@example.com"
                    role: "project-owner"
                    avatarUrl: "https://supabase.co/storage/v1/object/sign/upload/avatar2.jpg?token=..."
                    bio: "Project manager"
                    location: "San Francisco, USA"
                count: 2
        "401":
          description: Unauthorized - Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  status:
                    type: integer
                    example: 401
                  message:
                    type: string
                    example: "Unauthorized"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  status:
                    type: integer
                    example: 500
                  message:
                    type: string
                    example: "Failed to fetch users"
                  error:
                    type: string
                    example: "Error message"

  /api/v1/user/{userId}/roles:
    post:
      summary: Assign role to user
      description: Assign a role to a user (Admin only)
      tags:
        - "ðŸ”µ USER SERVICE - Role Management"
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
          description: User ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  type: string
                  enum: [developer, project-owner, admin]
      responses:
        "200":
          description: Role assigned successfully
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Admin only
        "404":
          description: User not found
    
    get:
      summary: Get user roles
      description: Retrieve all roles assigned to a user (Admin only)
      tags:
        - "ðŸ”µ USER SERVICE - Role Management"
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
          description: User ID
      responses:
        "200":
          description: User roles returned
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Admin only
        "404":
          description: User not found

  /api/v1/user/{userId}/roles/{role}:
    delete:
      summary: Remove role from user
      description: Remove a specific role from a user (Admin only)
      tags:
        - "ðŸ”µ USER SERVICE - Role Management"
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
          description: User ID
        - name: role
          in: path
          required: true
          schema:
            type: string
            enum: [developer, project-owner, admin]
          description: Role to remove
      responses:
        "200":
          description: Role removed successfully
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Admin only
        "404":
          description: User not found

  /api/v1/user/{userId}/with-roles:
    get:
      summary: Get user with roles
      description: Retrieve user details along with all assigned roles (Admin only)
      tags:
        - "ðŸ”µ USER SERVICE - Role Management"
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
          description: User ID
      responses:
        "200":
          description: User with roles returned
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Admin only
        "404":
          description: User not found

  /api/v1/user/roles/stats:
    get:
      summary: Get role statistics
      description: Get statistics about user roles in the system (Admin only)
      tags:
        - "ðŸ”µ USER SERVICE - Role Management"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Role statistics returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      developer:
                        type: integer
                        example: 150
                      projectOwner:
                        type: integer
                        example: 50
                      admin:
                        type: integer
                        example: 5
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Admin only
        "500":
          description: Internal server error

  # ============================================
  # PORTFOLIO SYNC ENDPOINTS
  # ============================================

  /api/v1/user/portfolio-sync/oauth/github:
    get:
      summary: Initiate GitHub OAuth for portfolio sync
      description: |
        Initiates GitHub OAuth flow for portfolio synchronization. 
        User must be authenticated. After authorization, tokens are stored encrypted in the database.
        Redirects to GitHub OAuth page, then back to callback URL.
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      responses:
        "302":
          description: Redirects to GitHub OAuth authorization page
          headers:
            Location:
              schema:
                type: string
                example: "https://github.com/login/oauth/authorize?client_id=..."
        "401":
          description: Unauthorized - Authentication required
        "500":
          description: Internal server error - Failed to save session

  /api/v1/user/portfolio-sync/oauth/github/callback:
    get:
      summary: GitHub OAuth callback for portfolio sync
      description: |
        GitHub OAuth callback handler. This endpoint is called by GitHub after user authorization.
        Tokens are automatically stored in the database (encrypted).
        Redirects to frontend portfolio sync page with status.
        - On success: Redirects to `/portfolio-sync?status=github_connected`
        - On failure: Redirects to `/portfolio-sync?error=github_connection_failed`
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      parameters:
        - name: code
          in: query
          schema:
            type: string
          description: GitHub OAuth authorization code
        - name: state
          in: query
          schema:
            type: string
          description: OAuth state parameter
        - name: error
          in: query
          schema:
            type: string
          description: OAuth error (if authorization was denied)
      responses:
        "302":
          description: Redirects to frontend with status (success or error)
          headers:
            Location:
              schema:
                type: string
                description: Frontend URL with status or error query parameter
                example: "http://localhost:5173/portfolio-sync?status=github_connected"
          content:
            application/json:
              schema:
                type: object
              examples:
                success:
                  summary: Successful connection
                  value:
                    redirect: "http://localhost:5173/portfolio-sync?status=github_connected"
                error:
                  summary: Connection failed
                  value:
                    redirect: "http://localhost:5173/portfolio-sync?error=github_connection_failed"

  /api/v1/user/portfolio-sync/oauth/stackoverflow:
    get:
      summary: StackOverflow OAuth information
      description: |
        Returns instructions for StackOverflow integration.
        StackOverflow OAuth is not fully implemented, so manual token connection is recommended.
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: StackOverflow OAuth instructions
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "StackOverflow OAuth integration"
                  instructions:
                    type: string
                    example: "Please use the connect endpoint with your access token"
        "401":
          description: Unauthorized

  /api/v1/user/portfolio-sync/status:
    get:
      summary: Get portfolio sync status
      description: Get synchronization status for all connected integrations (GitHub, StackOverflow)
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Sync status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/SyncStatus"
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/portfolio-sync/integrations:
    get:
      summary: Get connected integrations
      description: Get list of all connected portfolio integrations
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Integrations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Integration"
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/portfolio-sync/integrations/github/connect:
    post:
      summary: Connect GitHub integration
      description: Connect GitHub account for portfolio synchronization
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [accessToken]
              properties:
                accessToken:
                  type: string
                  description: GitHub OAuth access token
                  example: "gho_xxxxxxxxxxxxxxxxxxxx"
                refreshToken:
                  type: string
                  description: GitHub OAuth refresh token (optional)
                  example: "ghr_xxxxxxxxxxxxxxxxxxxx"
                expiresIn:
                  type: integer
                  description: Token expiration time in seconds
                  example: 3600
                scope:
                  type: string
                  description: OAuth scopes granted
                  example: "read:user,repo"
      responses:
        "200":
          description: GitHub connected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "GitHub connected successfully"
                  data:
                    type: object
                    properties:
                      platform:
                        type: string
                        example: "github"
                      username:
                        type: string
                        example: "johndoe"
        "400":
          description: Bad request - missing access token
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/portfolio-sync/integrations/stackoverflow/connect:
    post:
      summary: Connect StackOverflow integration
      description: Connect StackOverflow account for portfolio synchronization
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [accessToken, userId]
              properties:
                accessToken:
                  type: string
                  description: StackOverflow OAuth access token
                  example: "xxxxxxxxxxxxxxxxxxxx"
                userId:
                  type: integer
                  description: StackOverflow user ID
                  example: 123456
                username:
                  type: string
                  description: StackOverflow username (optional)
                  example: "johndoe"
      responses:
        "200":
          description: StackOverflow connected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "StackOverflow connected successfully"
                  data:
                    type: object
                    properties:
                      platform:
                        type: string
                        example: "stackoverflow"
                      userId:
                        type: integer
                        example: 123456
        "400":
          description: Bad request - missing required fields
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/portfolio-sync/integrations/{platform}/disconnect:
    post:
      summary: Disconnect integration
      description: Disconnect a portfolio integration (GitHub or StackOverflow)
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      parameters:
        - name: platform
          in: path
          required: true
          schema:
            type: string
            enum: [github, stackoverflow]
          description: Platform to disconnect
      responses:
        "200":
          description: Integration disconnected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "github disconnected successfully"
        "400":
          description: Bad request - invalid platform
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/portfolio-sync/sync:
    post:
      summary: Trigger portfolio sync
      description: |
        Trigger synchronization for a specific platform or all platforms.
        - For 'github': Syncs repositories and commits, calculates skills
        - For 'stackoverflow': Syncs answers and tags, calculates skills
        - For 'portfolio': Syncs portfolio URL (placeholder - web scraping not implemented)
        - For 'all': Syncs all connected platforms
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                platform:
                  type: string
                  enum: [github, stackoverflow, portfolio, all]
                  default: all
                  description: Platform to sync. Use 'portfolio' to sync from portfolio URL, 'all' to sync all platforms
                  example: "all"
                stackOverflowUserId:
                  type: integer
                  description: Optional StackOverflow user ID (will be retrieved from integration token or user profile if not provided)
                  example: 123456
                portfolioUrl:
                  type: string
                  description: Optional portfolio URL (will be retrieved from user profile if not provided)
                  example: "https://johndoe.dev"
      responses:
        "200":
          description: Sync completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Sync completed"
                  data:
                    oneOf:
                      - $ref: "#/components/schemas/GitHubSyncResult"
                      - $ref: "#/components/schemas/StackOverflowSyncResult"
                      - $ref: "#/components/schemas/PortfolioSyncResult"
                      - $ref: "#/components/schemas/AllPlatformsSyncResult"
              examples:
                github:
                  value:
                    success: true
                    message: "Sync completed"
                    data:
                      success: true
                      data:
                        repositories: []
                        commits: []
                        totalRepos: 25
                        totalCommits: 150
                        totalStars: 500
                      skills:
                        JavaScript:
                          score: 90
                          level: "expert"
                          evidenceCount: 45
                      githubUsername: "johndoe"
                      githubUrl: "https://github.com/johndoe"
                all:
                  value:
                    success: true
                    message: "Sync completed"
                    data:
                      github:
                        success: true
                        data:
                          totalRepos: 25
                          totalCommits: 150
                        skills: {}
                      stackoverflow:
                        success: true
                        data:
                          totalAnswers: 150
                          totalReputation: 5000
                        skills: {}
                      portfolio:
                        success: true
                        portfolioScore: 85
                      errors: []
        "400":
          description: Bad request - missing required fields or invalid platform
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Invalid platform"
                  status:
                    type: integer
                    example: 400
        "401":
          description: Unauthorized
        "500":
          description: Internal server error - sync failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "GitHub not connected. Please connect your GitHub account first."
                  status:
                    type: integer
                    example: 500

  /api/v1/user/portfolio-sync/history:
    get:
      summary: Get sync history
      description: Get synchronization history for the authenticated user
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: Maximum number of history records to return
      responses:
        "200":
          description: Sync history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/SyncHistory"
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/portfolio-sync/data:
    get:
      summary: Get sync data
      description: Get synchronized portfolio data from connected platforms
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      parameters:
        - name: platform
          in: query
          schema:
            type: string
            enum: [github, stackoverflow]
          description: Filter by platform (optional)
        - name: dataType
          in: query
          schema:
            type: string
          description: Filter by data type (e.g., 'repository', 'answer')
      responses:
        "200":
          description: Sync data retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/SyncData"
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/portfolio-sync/skills:
    get:
      summary: Get skill scores
      description: |
        Get calculated skill scores from portfolio data.
        - Use 'overall' or omit parameter to get aggregated skills from all platforms
        - Use 'github' to get skills from GitHub repositories only
        - Use 'stackoverflow' to get skills from StackOverflow tags only
        - Use 'portfolio' to get skills from portfolio URL (if available)
      tags:
        - "ðŸ”µ USER SERVICE - Portfolio Sync"
      security:
        - bearerAuth: []
      parameters:
        - name: platform
          in: query
          schema:
            type: string
            enum: [github, stackoverflow, portfolio, overall]
            default: overall
          description: Platform to get skills for, or 'overall' for aggregated skills from all platforms
      responses:
        "200":
          description: Skill scores retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    oneOf:
                      - $ref: "#/components/schemas/SkillScores"
                      - type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                            userId:
                              type: integer
                            platform:
                              type: string
                            skillName:
                              type: string
                            score:
                              type: integer
                            level:
                              type: string
                            evidenceCount:
                              type: integer
                            lastCalculatedAt:
                              type: string
                              format: date-time
              examples:
                overall:
                  value:
                    success: true
                    data:
                      overallScore: 85
                      skills:
                        JavaScript:
                          score: 90
                          level: "expert"
                          evidenceCount: 45
                        Python:
                          score: 75
                          level: "advanced"
                          evidenceCount: 30
                platform:
                  value:
                    success: true
                    data:
                      - id: 1
                        userId: 123
                        platform: "github"
                        skillName: "JavaScript"
                        score: 90
                        level: "expert"
                        evidenceCount: 45
                        lastCalculatedAt: "2024-01-15T10:30:00Z"
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  # ============================================
  # NOTIFICATION ENDPOINTS
  # ============================================

  /api/v1/user/notifications:
    get:
      summary: Get all notifications
      description: Retrieve all notifications for the authenticated user with optional filters
      tags:
        - "ðŸ”µ USER SERVICE - Notifications"
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
          description: Filter by notification type
        - name: category
          in: query
          schema:
            type: string
          description: Filter by category
        - name: read
          in: query
          schema:
            type: boolean
          description: Filter by read status
        - name: priority
          in: query
          schema:
            type: string
            enum: [low, medium, high]
          description: Filter by priority
        - name: archived
          in: query
          schema:
            type: boolean
            default: false
          description: Include archived notifications
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 500
          description: Maximum number of notifications to return
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Number of notifications to skip
      responses:
        "200":
          description: Notifications retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Notifications retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Notification"
                  count:
                    type: integer
                    example: 25
        "400":
          description: Bad request
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

    post:
      summary: Create notification
      description: Create a new notification for the authenticated user or a specified user
      tags:
        - "ðŸ”µ USER SERVICE - Notifications"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationCreate"
      responses:
        "201":
          description: Notification created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 201
                  message:
                    type: string
                    example: "Notification created successfully"
                  data:
                    $ref: "#/components/schemas/Notification"
        "400":
          description: Bad request - missing required fields
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

    delete:
      summary: Delete all notifications
      description: Delete all notifications for the authenticated user
      tags:
        - "ðŸ”µ USER SERVICE - Notifications"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: All notifications deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "All notifications deleted successfully"
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/notifications/unread-count:
    get:
      summary: Get unread notifications count
      description: Get the count of unread notifications for the authenticated user
      tags:
        - "ðŸ”µ USER SERVICE - Notifications"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Unread count retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Unread count retrieved successfully"
                  data:
                    type: object
                    properties:
                      count:
                        type: integer
                        example: 5
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/notifications/{notificationId}/read:
    put:
      summary: Mark notification as read
      description: Mark a specific notification as read
      tags:
        - "ðŸ”µ USER SERVICE - Notifications"
      security:
        - bearerAuth: []
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            type: integer
          description: Notification ID
      responses:
        "200":
          description: Notification marked as read
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Notification marked as read"
                  data:
                    $ref: "#/components/schemas/Notification"
        "400":
          description: Bad request - notification ID required
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - notification does not belong to user
        "404":
          description: Notification not found
        "500":
          description: Internal server error

  /api/v1/user/notifications/read-all:
    put:
      summary: Mark all notifications as read
      description: Mark all notifications as read for the authenticated user
      tags:
        - "ðŸ”µ USER SERVICE - Notifications"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: All notifications marked as read
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "All notifications marked as read"
        "401":
          description: Unauthorized
        "500":
          description: Internal server error

  /api/v1/user/notifications/{notificationId}:
    delete:
      summary: Delete notification
      description: Delete a specific notification
      tags:
        - "ðŸ”µ USER SERVICE - Notifications"
      security:
        - bearerAuth: []
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            type: integer
          description: Notification ID
      responses:
        "200":
          description: Notification deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Notification deleted successfully"
                  data:
                    $ref: "#/components/schemas/Notification"
        "400":
          description: Bad request - notification ID required
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - notification does not belong to user
        "404":
          description: Notification not found
        "500":
          description: Internal server error

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        uuid:
          type: string
        name:
          type: string
        email:
          type: string
        bio:
          type: string
        avatarUrl:
          type: string
        domainPreferences:
          type: string
        skills:
          type: object
        experience:
          type: string
        location:
          type: string
        availability:
          type: string
        resumeUrl:
          type: string
        xp:
          type: integer
        badges:
          type: array
          items:
            type: string
        level:
          type: integer
        githubUrl:
          type: string
        linkedinUrl:
          type: string
        stackoverflowUrl:
          type: string
        portfolioScore:
          type: integer
        isEmailVerified:
          type: boolean
        notificationPrefs:
          type: object
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    UserUpdate:
      type: object
      properties:
        name:
          type: string
          example: Rajan Kumar
        bio:
          type: string
          example: Full Stack Developer
        avatarUrl:
          type: string
          example: https://example.com/avatar.png
        domainPreferences:
          type: string
          example: web, ai-ml
        skills:
          type: object
          example: { "javascript": "advanced", "react": "intermediate" }
        experience:
          type: string
          example: 3 years
        location:
          type: string
          example: Nagpur, Maharashtra
        availability:
          type: string
          example: full-time
        resumeUrl:
          type: string
          example: https://example.com/resume.pdf
        xp:
          type: integer
          example: 0
        badges:
          type: array
          items:
            type: string
          example: ["Top Performer"]
        level:
          type: integer
          example: 1
        githubUrl:
          type: string
          example: https://github.com/raobaba
        linkedinUrl:
          type: string
          example: https://www.linkedin.com/in/kumar-rajan
        stackoverflowUrl:
          type: string
          example: https://stackoverflow.com/users/123456
        portfolioScore:
          type: integer
          example: 0
        portfolioUrl:
          type: string
          example: https://johndoe.dev
        notificationPrefs:
          type: object
          example: { "email": true, "sms": false }
      required: []

    # Portfolio Sync Schemas
    SyncStatus:
      type: object
      properties:
        integrations:
          type: object
          properties:
            github:
              type: object
              properties:
                connected:
                  type: boolean
                  example: true
                lastSync:
                  type: string
                  format: date-time
                  nullable: true
                  example: "2024-01-15T10:30:00Z"
                dataCount:
                  type: integer
                  example: 25
            stackoverflow:
              type: object
              properties:
                connected:
                  type: boolean
                  example: true
                lastSync:
                  type: string
                  format: date-time
                  nullable: true
                  example: "2024-01-15T10:30:00Z"
                dataCount:
                  type: integer
                  example: 15
        overallScore:
          type: integer
          description: Overall portfolio score (average of all skill scores)
          minimum: 0
          maximum: 100
          example: 85
        skills:
          type: object
          additionalProperties:
            type: object
            properties:
              score:
                type: integer
                example: 90
              level:
                type: string
                enum: [beginner, intermediate, advanced, expert]
                example: "expert"
              evidenceCount:
                type: integer
                example: 45
          description: Skills with scores, levels, and evidence counts
          example:
            JavaScript:
              score: 90
              level: "expert"
              evidenceCount: 45
            Python:
              score: 75
              level: "advanced"
              evidenceCount: 30
        lastSync:
          type: string
          format: date-time
          nullable: true
          description: Timestamp of last successful sync
          example: "2024-01-15T10:30:00Z"

    Integration:
      type: object
      properties:
        platform:
          type: string
          enum: [github, stackoverflow]
          example: "github"
        username:
          type: string
          example: "johndoe"
        connectedAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
        lastSync:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-15T10:30:00Z"

    SyncHistory:
      type: object
      properties:
        id:
          type: integer
          description: Sync history record ID
          example: 1
        userId:
          type: integer
          description: User ID who performed the sync
          example: 123
        platform:
          type: string
          enum: [github, stackoverflow, portfolio, all]
          description: Platform that was synced
          example: "github"
        status:
          type: string
          enum: [success, partial, failed]
          description: Sync status - 'success' if all items synced, 'partial' if some failed, 'failed' if sync failed
          example: "success"
        itemsSynced:
          type: integer
          description: Total number of items synced (repositories + commits, answers + tags, etc.)
          default: 0
          example: 175
        itemsUpdated:
          type: integer
          description: Number of items updated (existing items that were refreshed)
          default: 0
          example: 25
        itemsFailed:
          type: integer
          description: Number of items that failed to sync
          default: 0
          example: 0
        errorMessage:
          type: string
          nullable: true
          description: Error message if sync failed or partially failed
          example: null
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          description: Additional sync metadata (username, user ID, completion details, etc.)
          example:
            githubUsername: "johndoe"
            totalRepos: 25
            totalCommits: 150
        startedAt:
          type: string
          format: date-time
          description: When the sync operation started
          example: "2024-01-15T10:30:00Z"
        completedAt:
          type: string
          format: date-time
          nullable: true
          description: When the sync operation completed (null if still in progress)
          example: "2024-01-15T10:30:15Z"

    SyncData:
      type: object
      properties:
        id:
          type: integer
          example: 1
        userId:
          type: integer
          example: 123
        platform:
          type: string
          enum: [github, stackoverflow, portfolio]
          example: "github"
        dataType:
          type: string
          enum: [repository, commit, answer, tag]
          description: Type of synced data
          example: "repository"
        platformItemId:
          type: string
          description: External platform's item ID
          example: "123456"
        title:
          type: string
          description: Item title or name
          example: "my-awesome-project"
        description:
          type: string
          nullable: true
          description: Item description
          example: "A cool project description"
        url:
          type: string
          nullable: true
          description: Item URL
          example: "https://github.com/johndoe/my-awesome-project"
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata (varies by dataType)
          example:
            language: "JavaScript"
            stars: 150
            forks: 25
            topics: ["react", "nodejs"]
            createdAt: "2024-01-01T00:00:00Z"
            updatedAt: "2024-01-15T00:00:00Z"
        syncedAt:
          type: string
          format: date-time
          description: When this item was last synced
          example: "2024-01-15T10:35:00Z"
        createdAt:
          type: string
          format: date-time
          description: When this record was created
          example: "2024-01-15T10:35:00Z"
        updatedAt:
          type: string
          format: date-time
          description: When this record was last updated
          example: "2024-01-15T10:35:00Z"

    SkillScores:
      type: object
      properties:
        overallScore:
          type: integer
          description: Overall portfolio score (average of all skill scores)
          minimum: 0
          maximum: 100
          example: 85
        skills:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/Skill"
          description: Skills with scores, levels, and evidence counts
          example:
            JavaScript:
              score: 90
              level: "expert"
              evidenceCount: 45
            Python:
              score: 75
              level: "advanced"
              evidenceCount: 30
            React:
              score: 80
              level: "expert"
              evidenceCount: 25

    Skill:
      type: object
      properties:
        score:
          type: integer
          description: Skill score (0-100)
          minimum: 0
          maximum: 100
          example: 90
        level:
          type: string
          enum: [beginner, intermediate, advanced, expert]
          description: Skill level based on score
          example: "expert"
        evidenceCount:
          type: integer
          description: Number of repositories/answers/tags demonstrating this skill
          example: 45

    GitHubSyncResult:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            repositories:
              type: array
              items:
                type: object
            commits:
              type: array
              items:
                type: object
            totalRepos:
              type: integer
              example: 25
            totalCommits:
              type: integer
              example: 150
            totalStars:
              type: integer
              example: 500
        skills:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/Skill"
        githubUsername:
          type: string
          example: "johndoe"
        githubUrl:
          type: string
          example: "https://github.com/johndoe"

    StackOverflowSyncResult:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            user:
              type: object
            answers:
              type: array
              items:
                type: object
            tags:
              type: array
              items:
                type: object
            totalAnswers:
              type: integer
              example: 150
            totalReputation:
              type: integer
              example: 5000
        skills:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/Skill"
        stackOverflowUserId:
          type: string
          example: "12345"

    PortfolioSyncResult:
      type: object
      properties:
        success:
          type: boolean
          example: true
        portfolioScore:
          type: integer
          example: 85
        skills:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/Skill"
        portfolioUrl:
          type: string
          example: "https://johndoe.dev"

    AllPlatformsSyncResult:
      type: object
      properties:
        github:
          $ref: "#/components/schemas/GitHubSyncResult"
          nullable: true
        stackoverflow:
          $ref: "#/components/schemas/StackOverflowSyncResult"
          nullable: true
        portfolio:
          $ref: "#/components/schemas/PortfolioSyncResult"
          nullable: true
        errors:
          type: array
          items:
            type: object
            properties:
              platform:
                type: string
                example: "github"
              error:
                type: string
                example: "GitHub not connected"
          description: Array of errors for platforms that failed to sync

    # Notification Schemas
    Notification:
      type: object
      properties:
        id:
          type: integer
          example: 1
        userId:
          type: integer
          example: 123
        type:
          type: string
          example: "project_invitation"
        title:
          type: string
          example: "New Project Invitation"
        message:
          type: string
          example: "You have been invited to join Project X"
        category:
          type: string
          example: "projects"
        priority:
          type: string
          enum: [low, medium, high]
          example: "medium"
        read:
          type: boolean
          example: false
        archived:
          type: boolean
          example: false
        action:
          type: string
          nullable: true
          example: "view_project"
        actionUrl:
          type: string
          nullable: true
          example: "/projects/123"
        relatedEntityId:
          type: integer
          nullable: true
          example: 123
        relatedEntityType:
          type: string
          nullable: true
          example: "project"
        metadata:
          type: object
          additionalProperties: true
          nullable: true
          example:
            projectName: "Project X"
            inviterName: "Jane Doe"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        readAt:
          type: string
          format: date-time
          nullable: true
          example: null

    NotificationCreate:
      type: object
      required: [type, title, message]
      properties:
        userId:
          type: integer
          description: Target user ID (optional, defaults to authenticated user)
          example: 123
        type:
          type: string
          description: Notification type
          example: "project_invitation"
        title:
          type: string
          description: Notification title
          example: "New Project Invitation"
        message:
          type: string
          description: Notification message
          example: "You have been invited to join Project X"
        category:
          type: string
          description: Notification category
          example: "projects"
        priority:
          type: string
          enum: [low, medium, high]
          default: medium
          example: "medium"
        action:
          type: string
          description: Action identifier
          example: "view_project"
        actionUrl:
          type: string
          description: URL for the action
          example: "/projects/123"
        relatedEntityId:
          type: integer
          description: Related entity ID
          example: 123
        relatedEntityType:
          type: string
          description: Related entity type
          example: "project"
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata
          example:
            projectName: "Project X"
            inviterName: "Jane Doe"
